local Players = game:GetService('Players')
local VirtualInputManager = game:GetService('VirtualInputManager')
local localPlayer = Players.LocalPlayer

-- âœ… List of your alts (15 slots used here)
local altList = {
    'TheGreatestTurtle12',
    'TheGreatestTurtle13',
    'TheGreatestTurtle14',
    'TheGreatestTurtle15',
    'TheGreatestTurtle16',
    'TheGreatestTurtle18',
    'TheGreatestTurtle19',
    'TheGreatestTurtle20',
    'TheGreatestTurtle21',
    'TheGreatestTurtle22',
    'dribblecurses',
    'oooeeewq',
    'osamasongamers',
    'ssprinklez0a',
}

-- Exception list: if your (injecting) username is on here, the script will do nothing.
-- Add usernames you want the script to ignore (case-insensitive).
local exceptionList = {
    ''
}

-- New/required list: script will only run if EVERY name in altList AND requiredList are present in the server.
local requiredList = {
    'psykoticpsykotic', 'AltFriend2'
}

-- Teleport positions (tight square layout)
local teleportPositions = {
    Vector3.new(-16, 4, -10), -- leftmost moved closer
    Vector3.new(-8, 4, -10),
    Vector3.new(0, 4, -10),
    Vector3.new(8, 4, -10),
    Vector3.new(16, 4, -10), -- rightmost moved closer

    Vector3.new(-16, 4, 0),
    Vector3.new(-8, 4, 0),
    Vector3.new(0, 4, 0),
    Vector3.new(8, 4, 0),
    Vector3.new(16, 4, 0),

    Vector3.new(-16, 4, 10),
    Vector3.new(-8, 4, 10),
    Vector3.new(0, 4, 10),
    Vector3.new(8, 4, 10),
    Vector3.new(16, 4, 10),
}

-- Configuration
getgenv().teleportInterval = 17 -- total time between teleports
getgenv().preSpamDelay = 2
getgenv().spamTime = 12
getgenv().spamKey = Enum.KeyCode.Three
local characterHeight = 7

-- utilities
local function nameEquals(a, b)
    if not a or not b then return false end
    return a:lower() == b:lower()
end

local function isInList(name, list)
    if not name or not list then return false end
    for _, v in pairs(list) do
        if v ~= '' and nameEquals(name, v) then
            return true
        end
    end
    return false
end

local function getAltIndex(name)
    for i, v in pairs(altList) do
        if v ~= '' and nameEquals(name, v) then
            return i
        end
    end
    return nil
end

-- Check that every non-empty name in `list` is present in Players
local function areAllAccountsPresent(list)
    if not list or #list == 0 then return true end
    for _, name in pairs(list) do
        if name ~= '' then
            local found = Players:FindFirstChild(name) ~= nil
            if not found then
                return false
            end
        end
    end
    return true
end

-- 1) If our local player is on the exception list -> exit immediately
if isInList(localPlayer.Name, exceptionList) then
    warn('Local player is on the exception list. Script will not run for this account.')
    return
end

-- 2) Local player must be in altList (so we know which teleportPositions index to use)
if not isInList(localPlayer.Name, altList) then
    warn('Local player is not in altList. Script will not run.')
    return
end

-- Main runner
print('Teleport + Key spam script initialized. Waiting for all required accounts to be present...')

task.spawn(function()
    while true do
        -- require ALL names in altList AND requiredList to be present
        local allPresent = areAllAccountsPresent(altList) and areAllAccountsPresent(requiredList)
        if not allPresent then
            -- pause and re-check in 5 seconds; the script won't perform teleports until condition is met
            warn('Not all accounts from altList/requiredList are present. Rechecking in 5s...')
            task.wait(5)
            continue
        end

        -- now that all are present, run the teleport + spam routine for this alt
        local startTime = os.clock()

        local character = localPlayer.Character or localPlayer.CharacterAdded:Wait()
        local humanoid = character:WaitForChild('Humanoid')
        local humanoidRootPart = character:WaitForChild('HumanoidRootPart')

        if humanoidRootPart and humanoid then
            local altIndex = getAltIndex(localPlayer.Name)
            local teleportPosition = teleportPositions[altIndex] or Vector3.new(-10, 4, -5)

            -- Safety: if teleportPosition is not mapped, warn and skip this cycle
            if not teleportPosition then
                warn('No teleport position found for this alt index. Skipping this cycle.')
            else
                -- Spam teleport with zero delay until dead
                local teleporting = true
                local teleportTask
                teleportTask = task.spawn(function()
                    while teleporting and humanoid.Health > 0 do
                        humanoidRootPart.CFrame = CFrame.new(teleportPosition + Vector3.new(0, characterHeight, 0))
                        task.wait() -- zero delay loop
                    end
                end)

                -- Wait before starting key spam (but also ensure the required accounts are still present)
                local preStart = os.clock()
                while os.clock() - preStart < getgenv().preSpamDelay do
                    if not (areAllAccountsPresent(altList) and areAllAccountsPresent(requiredList)) then
                        warn('Required accounts left during pre-spam delay. Stopping this run.')
                        teleporting = false
                        break
                    end
                    task.wait(0.1)
                end

                -- Spam key for spamTime seconds, stop if dead or if required accounts leave
                if teleporting then
                    local spamStart = os.clock()
                    while os.clock() - spamStart < getgenv().spamTime do
                        if humanoid.Health <= 0 then
                            break
                        end
                        if not (areAllAccountsPresent(altList) and areAllAccountsPresent(requiredList)) then
                            warn('Required accounts left during spam. Aborting spam early.')
                            break
                        end
                        VirtualInputManager:SendKeyEvent(true, getgenv().spamKey, false, game)
                        task.wait(0.05)
                        VirtualInputManager:SendKeyEvent(false, getgenv().spamKey, false, game)
                        task.wait(0.05)
                    end
                end

                -- Stop teleport spam
                teleporting = false
            end

            -- Wait remaining time until next teleport interval (but if required accounts leave, we will break earlier)
            local elapsed = os.clock() - startTime
            local remainingTime = getgenv().teleportInterval - elapsed
            local waited = 0
            while remainingTime > 0 and waited < remainingTime do
                if not (areAllAccountsPresent(altList) and areAllAccountsPresent(requiredList)) then
                    warn('Required accounts left during wait. Pausing until all are back.')
                    break
                end
                task.wait(0.5)
                waited = waited + 0.5
            end
        else
            task.wait(1)
        end
    end
end)

print('Script running (subject to presence of all accounts in altList & requiredList).')
